<div class="p-4 bg-white shadow-md">
  <div class="flex justify-between mb-4">
    <mat-paginator
      class="bg-white"
      [pageSizeOptions]="pageSizeOptions"
      [length]="totalItems"
      [pageSize]="shopParams.pageSize"
      (page)="handlePageEvent($event)"
      showFirstLastButtons
    ></mat-paginator>
    <h2 class="text-2xl font-semibold text-gray-800 mt-2">Admin Categories</h2>
    <button
      mat-raised-button
      color="primary"
      [routerLink]="['/admin/categories/create']"
      class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-sm mt-2"
    >
      <mat-icon>add</mat-icon>
      Create New Category
    </button>
  </div>

  <div class="bg-white rounded-lg shadow-md">
    <mat-tree
      [dataSource]="dataSource"
      [treeControl]="treeControl"
      class="w-full"
    >
      <mat-tree-node
        *matTreeNodeDef="let node"
        matTreeNodePadding
        class="node-item"
      >
        <div class="flex items-center w-full py-2 hover:bg-gray-50">
          <div class="w-10 flex justify-center">
            <mat-icon class="text-gray-300">subdirectory_arrow_right</mat-icon>
          </div>

          <div class="w-16 h-16 mr-4">
            <img
              [src]="getCategoryImage(node.imagePath)"
              alt="Category"
              class="w-full h-full object-cover rounded-sm"
            />
          </div>
          <span class="flex-grow truncate">{{ node.name }}</span>
          <div class="flex items-center gap-3 mr-4">
            <button
              mat-button
              [routerLink]="['/admin/categories/edit', node.id]"
              (click)="$event.stopPropagation()"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <button
              mat-button
              (click)="$event.stopPropagation(); deleteCategory(node.id)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </mat-tree-node>

      <mat-tree-node
        *matTreeNodeDef="let node; when: hasChild"
        matTreeNodePadding
        class="node-item"
      >
        <div
          class="flex items-center w-full py-2 hover:bg-gray-50 cursor-pointer"
          (click)="toggleNode(node)"
        >
          <div class="w-10 flex justify-center">
            <mat-icon class="text-blue-500">
              {{
                treeControl.isExpanded(node) ? "expand_more" : "chevron_right"
              }}
            </mat-icon>
          </div>

          <div class="w-16 h-16 mr-4">
            <img
              [src]="getCategoryImage(node.imagePath)"
              alt="Category"
              class="w-full h-full object-cover rounded-sm"
            />
          </div>

          <div class="flex-grow">
            <span class="font-medium truncate">{{ node.name }}</span>
          </div>

          <div
            class="flex items-center gap-3 mr-4"
            (click)="$event.stopPropagation()"
          >
            <button
              mat-button
              [routerLink]="['/admin/categories/edit', node.id]"
              color="primary"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <button mat-button (click)="deleteCategory(node.id)" color="warn">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </mat-tree-node>

      <mat-tree-node
        *matTreeNodeDef="let node; when: isLoading"
        matTreeNodePadding
      >
        <div class="flex items-center">
          <mat-progress-spinner
            diameter="20"
            mode="indeterminate"
            class="mr-2"
          ></mat-progress-spinner>
          <span class="text-gray-500">Loading...</span>
        </div>
      </mat-tree-node>

      <ng-container *ngIf="dataSource.data.length === 0">
        <div class="p-8 text-center text-gray-500">
          <mat-icon class="text-4xl mb-2">category</mat-icon>
          <p>No categories found</p>
          <button
            mat-raised-button
            color="primary"
            [routerLink]="['/admin/categories/create']"
            class="mt-4"
          >
            Create your first category
          </button>
        </div>
      </ng-container>
    </mat-tree>
  </div>
</div>
