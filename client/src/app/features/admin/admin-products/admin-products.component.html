<app-product-list
  [products]="products"
  [shopParams]="shopParams"
  [pageSizeOptions]="pageSizeOptions"
  [sortOptions]="sortOptions"
  (pageChanged)="handlePageEvent($event)"
  (searchChanged)="onSearchChange()"
  (sortChanged)="onSortChange($event)"
>
  <table
    mat-table
    [dataSource]="products?.data || []"
    class="mat-elevation-z8 w-full mt-4"
  >
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef class="text-center">Name</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ product.name }}
      </td>
    </ng-container>

    <ng-container matColumnDef="category">
      <th mat-header-cell *matHeaderCellDef class="text-center">Category</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ getCategoryName(product.categoryId) }}
      </td>
    </ng-container>

    <ng-container matColumnDef="carModels">
      <th mat-header-cell *matHeaderCellDef class="text-center">Car Models</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ getCarModelNames(product.carModelIds) }}
      </td>
    </ng-container>

    <ng-container matColumnDef="specifications">
      <th mat-header-cell *matHeaderCellDef class="text-center">
        Specifications
      </th>
      <td
        mat-cell
        *matCellDef="let product"
        class="text-left whitespace-pre-wrap px-2"
      >
        <div *ngIf="product.specifications?.length > 0; else noSpecs">
          <div *ngFor="let spec of product.specifications">
            <strong>{{ spec.specificationName }}:</strong>
            {{ spec.specificationValue }}
          </div>
        </div>
        <ng-template #noSpecs>â€”</ng-template>
      </td>
    </ng-container>

    <ng-container matColumnDef="vendorCode">
      <th mat-header-cell *matHeaderCellDef class="text-center">VendorCode</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ product.vendorCode }}
      </td>
    </ng-container>

    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef class="text-center">Price</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ product.price | currency }}
      </td>
    </ng-container>

    <ng-container matColumnDef="discount">
      <th mat-header-cell *matHeaderCellDef class="text-center">Discount</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ product.discount }}%
      </td>
    </ng-container>

    <ng-container matColumnDef="stock">
      <th mat-header-cell *matHeaderCellDef class="text-center">Stock</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        {{ product.stock }}
      </td>
    </ng-container>

    <ng-container matColumnDef="isAvailable">
      <th mat-header-cell *matHeaderCellDef class="text-center">Available</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        <mat-slide-toggle
          [checked]="product.isAvailable"
          (change)="toggleAvailability(product)"
          color="primary"
          class="!ml-2 !mt-1"
        >
        </mat-slide-toggle>
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef class="text-center">Actions</th>
      <td mat-cell *matCellDef="let product" class="text-center">
        <button
          mat-button
          color="primary"
          [routerLink]="['/admin/products/edit', product.id]"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-sm"
        >
          Edit
        </button>
        <button
          mat-button
          color="warn"
          (click)="deleteProduct(product.id)"
          class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-sm ml-2"
        >
          Delete
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <div class="flex justify-start">
    <button
      mat-button
      color="accent"
      [routerLink]="['/admin/products/create']"
      class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-sm m-4"
    >
      Create
    </button>
  </div>
</app-product-list>
