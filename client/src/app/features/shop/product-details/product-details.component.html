<section class="py-4" *ngIf="product">
  <div class="max-w-(--breakpoint-2xl) px-4 mx-auto">
    <div class="grid grid-cols-2 gap-8">
      <div>
        <div class="relative w-full max-w-md mx-auto mt-4">
          <div
            class="image-container flex items-center justify-center h-[400px] mb-4 relative"
            (mousemove)="onImageZoom($event)"
            (mouseenter)="showZoom = true"
            (mouseleave)="showZoom = false"
          >
            <img
              *ngIf="product.images.length > 0; else noImage"
              [src]="getImageUrl(product.images[activeIndex].path)"
              alt="Product Image"
              class="product-image max-h-full max-w-full cursor-zoom-in"
              #productImg
            />

            <div
              *ngIf="showZoom && product.images.length > 0"
              class="zoom-result absolute rounded-lg shadow-lg pointer-events-none"
              [ngStyle]="zoomStyle"
            ></div>

            <ng-template #noImage>
              <img
                src="images/no-image.jpeg"
                alt="No product image"
                class="product-image max-h-full max-w-full"
              />
            </ng-template>
          </div>

          <button
            mat-icon-button
            class="absolute -left-6 top-1/2 transform -translate-y-1/2 bg-white shadow-md rounded-full hover:bg-blue-100 hover:shadow-lg transition-all nav-button"
            (click)="previousImage()"
          >
            <mat-icon class="text-blue-500">arrow_back</mat-icon>
          </button>

          <button
            mat-icon-button
            class="absolute -right-6 top-1/2 transform -translate-y-1/2 bg-white shadow-md rounded-full hover:bg-blue-100 hover:shadow-lg transition-all nav-button"
            (click)="nextImage()"
          >
            <mat-icon class="text-blue-500">arrow_forward</mat-icon>
          </button>
        </div>

        <div class="flex justify-center mt-4 space-x-2">
          <button
            *ngFor="let img of product.images; let i = index"
            class="w-3 h-3 rounded-full transition-all duration-300"
            [ngClass]="{
              'bg-gray-400': activeIndex !== i,
              'bg-blue-600': activeIndex === i
            }"
            (click)="activeIndex = i"
            aria-label="Image pagination dot"
          ></button>
        </div>
      </div>
      <div>
        <h1 class="text-3xl font-semibold text-gray-900">
          {{ product.vendorCode }}
        </h1>
        <h2 class="text-2xl font-semibold text-gray-900">{{ product.name }}</h2>

        <div class="mt-3 p-3 bg-gray-50 rounded-md border border-gray-200">
          <h3 class="text-md font-semibold text-gray-700">Compatible with:</h3>
          <p class="text-sm text-gray-600 mt-1">
            {{ getCompatibleCarModels() }}
          </p>
        </div>

        <div *ngIf="product.isAvailable; else notAvailable" class="mt-3">
          <p>Is Available</p>
        </div>
        <ng-template #notAvailable>
          <p class="text-red-500 mt-3">Not available</p>
        </ng-template>

        <div
          class="flex-col gap-4 mt-6"
          *ngIf="product.isAvailable; else notAvailableBtn"
        >
          <mat-form-field appearance="outline" class="flex">
            <mat-label>Quantity</mat-label>
            <input matInput min="0" [(ngModel)]="quantity" type="number" />
          </mat-form-field>
          <div *ngIf="product.discount > 0; else noDiscount">
            <div class="text-xl text-gray-500 line-through">
              {{ product.price * quantity | currency }}
            </div>
            <div class="text-3xl font-extrabold text-red-600">
              {{
                product.price * quantity - product.discount * quantity
                  | currency
              }}
            </div>
          </div>

          <ng-template #noDiscount>
            <div class="text-xl font-semibold text-black">
              {{ product.price | currency }}
            </div>
          </ng-template>

          <button
            class="mt-4"
            [disabled]="quantity === quantityInCart"
            (click)="updateCart()"
            mat-flat-button
          >
            <mat-icon>shopping_cart</mat-icon>
            {{ getButtonText() }}
          </button>
        </div>

        <ng-template #notAvailableBtn>
          <div class="flex-col gap-4 mt-6">
            <mat-form-field appearance="outline" class="flex">
              <mat-label>Quantity</mat-label>
              <input
                matInput
                min="0"
                disabled="true"
                [(ngModel)]="quantity"
                type="number"
              />
            </mat-form-field>
            <button
              mat-stroked-button
              (click)="openCallbackDialog()"
              class="ml-4"
            >
              <mat-icon class="text-2xl">support_agent</mat-icon>
              <span class="text-lg font-medium">Request a call</span>
            </button>
            <div class="text-xl font-semibold text-blue-200">
              {{ product.price | currency }}
            </div>

            <button class="mt-4 bg-blue-300" disabled="" mat-flat-button>
              <mat-icon>shopping_cart</mat-icon>
              {{ getButtonText() }}
            </button>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="max-w-7xl mx-auto my-8">
      <mat-tab-group
        #tabGroup
        mat-stretch-tabs="true"
        mat-align-tabs="center"
        class="specification-tabs"
      >
        <mat-tab>
          <ng-template mat-tab-label>
            <div
              class="px-4 py-2 font-medium text-sm"
              [ngClass]="{
                'text-blue-700': tabGroup.selectedIndex === 0,
                'text-gray-700': tabGroup.selectedIndex !== 0
              }"
            >
              SPECIFICATION
            </div>
          </ng-template>
          <div class="p-4 border border-gray-300 border-t-0 rounded-b-lg">
            <p
              class="text-sm text-gray-700"
              *ngFor="let spec of product.specifications"
            >
              {{ spec.specificationName }}: {{ spec.specificationValue }}
            </p>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <div
              class="px-4 py-2 font-medium text-sm"
              [ngClass]="{
                'text-blue-700': tabGroup.selectedIndex === 1,
                'text-gray-700': tabGroup.selectedIndex !== 1
              }"
            >
              PAYMENT
            </div>
          </ng-template>
          <div class="p-4 border border-gray-300 border-t-0 rounded-b-lg">
            <p class="text-sm text-gray-700">
              Lorem ipsum is simply dummy text of the printing and typesetting
              industry. Lorem Ipsum has been the industry's standard dummy text
              ever since the 1500s, when an unknown printer took a galley of
              type and scrambled it to make a type specimen book.
            </p>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <div
              class="px-4 py-2 font-medium text-sm"
              [ngClass]="{
                'text-blue-700': tabGroup.selectedIndex === 2,
                'text-gray-700': tabGroup.selectedIndex !== 2
              }"
            >
              DELIVERY
            </div>
          </ng-template>
          <div class="p-4 border border-gray-300 border-t-0 rounded-b-lg">
            <p class="text-sm text-gray-700">
              Lorem ipsum is simply dummy text of the printing and typesetting
              industry. Lorem Ipsum has been the industry's standard dummy text
              ever since the 1500s.
            </p>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <div
              class="px-4 py-2 font-medium text-sm"
              [ngClass]="{
                'text-blue-700': tabGroup.selectedIndex === 3,
                'text-gray-700': tabGroup.selectedIndex !== 3
              }"
            >
              WARRANTY
            </div>
          </ng-template>
          <div class="p-4 border border-gray-300 border-t-0 rounded-b-lg">
            <p class="text-sm text-gray-700">
              Lorem ipsum is simply dummy text of the printing and typesetting
              industry. Lorem Ipsum has been the industry's standard dummy text
              ever since the 1500s, when an unknown printer took a galley of
              type.
            </p>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>

    <app-related-products
      [categoryId]="product.categoryId"
      [currentProductId]="product.id"
    >
    </app-related-products>
  </div>
</section>
